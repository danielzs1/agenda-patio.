<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agendar Cita</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAGpefaI4KKoUzKbmAUp_QHH1QCJJon6Dg",
      authDomain: "agendapatio-bd75e.firebaseapp.com",
      projectId: "agendapatio-bd75e",
      storageBucket: "agendapatio-bd75e.appspot.com",
      messagingSenderId: "2629668570",
      appId: "1:2629668570:web:13ac210ecf525e09a99fe3",
      measurementId: "G-E6XPFLQVQR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.agendarCita = async function () {
      const transportadora = document.getElementById("transportadora").value;
      const conductor = document.getElementById("conductor").value;
      const placa = document.getElementById("placa").value;
      const fecha = document.getElementById("fecha").value;
      const franjaHoraria = document.getElementById("franja").value;

      if (!transportadora || !conductor || !placa || !fecha || !franjaHoraria) {
        alert("Por favor completa todos los campos.");
        return;
      }

      const citasRef = collection(db, "citas");
      const q = query(citasRef, where("fecha", "==", fecha), where("franjaHoraria", "==", franjaHoraria));
      const querySnapshot = await getDocs(q);

      if (!querySnapshot.empty) {
        alert("Ya hay una cita agendada para esa fecha y franja horaria. Elige otra.");
        return;
      }

      await addDoc(citasRef, {
        transportadora,
        conductor,
        placa,
        fecha,
        franjaHoraria
      });

      const mensaje = document.getElementById("mensaje");
      mensaje.innerText = "Cita agendada correctamente.";
      setTimeout(() => mensaje.innerText = "", 2500);

      document.getElementById("form-cita").reset();
    }
  </script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 15px; padding: 10px; width: 100%; background: #2a9d8f; color: white; border: none; cursor: pointer; }
    #mensaje { margin-top: 10px; color: green; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Agendar Cita</h2>
  <form id="form-cita" onsubmit="event.preventDefault(); agendarCita();">
    <label>Transportadora</label>
    <input type="text" id="transportadora">

    <label>Conductor</label>
    <input type="text" id="conductor">

    <label>Placa</label>
    <input type="text" id="placa">

    <label>Fecha</label>
    <input type="date" id="fecha">

    <label>Franja Horaria</label>
    <select id="franja">
      <option value="8:00 a 8:20">8:00 a 8:20</option>
      <option value="8:20 a 8:40">8:20 a 8:40</option>
      <option value="8:40 a 9:00">8:40 a 9:00</option>
    </select>

    <button type="submit">Agendar</button>
    <div id="mensaje"></div>
  </form>

<hr>
<p>üîê <a href="admin.html">Login interno (solo personal autorizado)</a></p>

</body>
</html>



